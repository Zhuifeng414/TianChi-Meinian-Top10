##################################################################################
#                                                                                #
#                            最终生成六个数据表：                                #
#    juz_train_6_6_add_wzm_for145_final2、juz_test_6_6_add_wzm_for145_final2     #
#     juz_train_6_6_add_wzm_for145_final、juz_test_6_6_add_wzm_for145_final      #
#     juz_train_6_6_add_wzm_onlytl_final、juz_test_6_6_add_wzm_onlytl_final      #
#																				 #
##################################################################################

from odps import ODPS
import pandas as pd
from sklearn.ensemble import GradientBoostingRegressor, RandomForestRegressor
from sklearn.ensemble._gradient_boosting import predict_stage
from odps.df import DataFrame
from sklearn.model_selection import KFold
import time
import numpy as np

if __name__ == "__main__":
    train = odps.get_table('juz_train_6_6_final').to_df().to_pandas()
    test = odps.get_table('juz_test_6_6_final').to_df().to_pandas()

    ex_cols = ['31', '193', '2406', '269017', '269024', '0112', '269019', '317', '979012', '269013', '979019', '669009', '1840', '300129', '2372', '269025', '300035', '979021', '979022', '1873', '669021', '100005', '100006', '300093', '2386', '100010', '192', '269008', '100008', '979006', '1127', '269003', '269004', '191', '0105', 'a703', '1814', '269005', '183', '809008', '979007', '300011', '669005', '269006', '269016', '143', '378', 'a701', '1474', '2404', '979017', '979023', '3197', '316', '709038', '979013', '809017', '33', '100013', '269020', '979018', '979005', '3193', '979020', '139', '809009', '10003', '190', '979001', '100012', '0108', '0106', '141', '10002', '300008', '979004', '315', '1850', '269010', '979009', '38', '269018', '809004', '809025', '1107', '2174', '659025', '809013', '269021', '2405', '269012', '809023', '809010', '809026', '32', '2403', '10004', '269014', '3191', '100014', '0111', '269015', '320', '313', '300109', '2986', '2420', '669002', '269022', '39', '0109', '300012', '314', '300014', '1112', '669008', '669003', '37', '100007', '312', '979015', '669004', '269009', '1845', '3430', '669007', '709049', '979008', '979003', '809001', '300001', '1110', '1815', '1345', '979011', '300021', '0104', '979016', '809021', '1117', '34', '2371', '300013', '269007', '1115', '979014', '3192', '319', '269011', '269023', '20002', '979002', '1106']
    new_cols = [i for i in train.columns if i not in ex_cols]
    
    train_wzm = odps.get_table('wzm_trainset3_3_b2').to_df().to_pandas()
    test_wzm = odps.get_table('wzm_testset3_3_b2').to_df().to_pandas()
    train1 = pd.merge(train, train_wzm[['vid', '0433', '1313', '0212', '0407', '0901', '0976', '3207', '3399', '0207', '0431', '0420', '1304', '0216', '0413', '0406', '0206', '0979', '0423', '2302', '0430', '3400', '0980', '0432', '0977','sugar_high_related']], on=['vid'], how='left')
    test1 = pd.merge(test, test_wzm[['vid', '0433', '1313', '0212', '0407', '0901', '0976', '3207', '3399', '0207', '0431', '0420', '1304', '0216', '0413', '0406', '0206', '0979', '0423', '2302', '0430', '3400', '0980', '0432', '0977','sugar_high_related']], on=['vid'], how='left')
    train1.fillna(-999, inplace=True)
    test1.fillna(-999, inplace=True)
    
    DataFrame(train1).persist('juz_train_6_6_add_wzm_for145_final2')
    DataFrame(test1).persist('juz_test_6_6_add_wzm_for145_final2')
    
#############################################################################################################################
    train_wzm = odps.get_table('wzm_trainset3_3_b').to_df().to_pandas()
    test_wzm = odps.get_table('wzm_testset3_3_b').to_df().to_pandas()
    train2 = pd.merge(train, train_wzm[['vid', '0433', '1313', '0212', '0407', '0901', '0976', '3207', '3399', '0207', '0431', '0420', '1304', '0216', '0413', '0406', '0206', '0979', '0423', '2302', '0430', '3400', '0980', '0432', '0977','sugar_high_related']], on=['vid'], how='left')
    test2 = pd.merge(test, test_wzm[['vid', '0433', '1313', '0212', '0407', '0901', '0976', '3207', '3399', '0207', '0431', '0420', '1304', '0216', '0413', '0406', '0206', '0979', '0423', '2302', '0430', '3400', '0980', '0432', '0977','sugar_high_related']], on=['vid'], how='left')
    train2.fillna(-999, inplace=True)
    test2.fillna(-999, inplace=True)
    
    DataFrame(train2).persist('juz_train_6_6_add_wzm_for145_final')
    DataFrame(test2).persist('juz_test_6_6_add_wzm_for145_final')
    
#############################################################################################################################
    train_wzm = odps.get_table('wzm_trainset3_3_b').to_df().to_pandas()
    test_wzm = odps.get_table('wzm_testset3_3_b').to_df().to_pandas()
    train3 = pd.merge(train[new_cols], train_wzm[['vid', '31', '193', '2406', '269017', '269024', '0112', '269019', '317', '979012', '269013', '979019', '669009', '1840', '300129', '2372', '269025', '300035', '979021', '979022', '1873', '669021', '100005', '100006', '300093', '2386', '100010', '192', '269008', '100008', '979006', '1127', '269003', '269004', '191', '0105', 'a703', '1814', '269005', '183', '809008', '979007', '300011', '669005', '269006', '269016', '143', '378', 'a701', '1474', '2404', '979017', '979023', '3197', '316', '709038', '979013', '809017', '33', '100013', '269020', '979018', '979005', '3193', '979020', '139', '809009', '10003', '190', '979001', '100012', '0108', '0106', '141', '10002', '300008', '979004', '315', '1850', '269010', '979009', '38', '269018', '809004', '809025', '1107', '2174', '659025', '809013', '269021', '2405', '269012', '809023', '809010', '809026', '32', '2403', '10004', '269014', '3191', '100014', '0111', '269015', '320', '313', '300109', '2986', '2420', '669002', '269022', '39', '0109', '300012', '314', '300014', '1112', '669008', '669003', '37', '100007', '312', '979015', '669004', '269009', '1845', '3430', '669007', '709049', '979008', '979003', '809001', '300001', '1110', '1815', '1345', '979011', '300021', '0104', '979016', '809021', '1117', '34', '2371', '300013', '269007', '1115', '979014', '3192', '319', '269011', '269023', '20002', '979002', '1106', '0435', '1328', '0405', '3196', '0425', '0201', '1305', '3195', '1303', '3190', '0707', '1315', '0973', '3730', '0433', '1313', '0212', '0407', '0901', '0976', '3207', '3399', '0207', '0431', '0420', '1304', '0216', '0413', '0406', '0206', '0979', '0423', '2302', '0430', '3400', '0980', '0432', '0977','sugar_high_related']], on=['vid'], how='left')
    test3 = pd.merge(test[new_cols], test_wzm[['vid', '31', '193', '2406', '269017', '269024', '0112', '269019', '317', '979012', '269013', '979019', '669009', '1840', '300129', '2372', '269025', '300035', '979021', '979022', '1873', '669021', '100005', '100006', '300093', '2386', '100010', '192', '269008', '100008', '979006', '1127', '269003', '269004', '191', '0105', 'a703', '1814', '269005', '183', '809008', '979007', '300011', '669005', '269006', '269016', '143', '378', 'a701', '1474', '2404', '979017', '979023', '3197', '316', '709038', '979013', '809017', '33', '100013', '269020', '979018', '979005', '3193', '979020', '139', '809009', '10003', '190', '979001', '100012', '0108', '0106', '141', '10002', '300008', '979004', '315', '1850', '269010', '979009', '38', '269018', '809004', '809025', '1107', '2174', '659025', '809013', '269021', '2405', '269012', '809023', '809010', '809026', '32', '2403', '10004', '269014', '3191', '100014', '0111', '269015', '320', '313', '300109', '2986', '2420', '669002', '269022', '39', '0109', '300012', '314', '300014', '1112', '669008', '669003', '37', '100007', '312', '979015', '669004', '269009', '1845', '3430', '669007', '709049', '979008', '979003', '809001', '300001', '1110', '1815', '1345', '979011', '300021', '0104', '979016', '809021', '1117', '34', '2371', '300013', '269007', '1115', '979014', '3192', '319', '269011', '269023', '20002', '979002', '1106', '0435', '1328', '0405', '3196', '0425', '0201', '1305', '3195', '1303', '3190', '0707', '1315', '0973', '3730', '0433', '1313', '0212', '0407', '0901', '0976', '3207', '3399', '0207', '0431', '0420', '1304', '0216', '0413', '0406', '0206', '0979', '0423', '2302', '0430', '3400', '0980', '0432', '0977','sugar_high_related']], on=['vid'], how='left')
    train3.fillna(-999, inplace=True)
    test3.fillna(-999, inplace=True)
    
    DataFrame(train3).persist('juz_train_6_6_add_wzm_onlytl_final')
    DataFrame(test3).persist('juz_test_6_6_add_wzm_onlytl_final')




    
    
    