# README

****
### 团队：Unreal

### 初赛Rank2，复赛Rank10
****

## 代码运行顺序

请在开始前确保已经将所有数据表复制到本项目的工作空间中。

1. 切换到Juzstu目录，并进入到data_pre_process文件夹：

   a. 运行origin_part1_part2_row2col，进行原始数据转换，包括行转列，去重等；

   b. 切换到Tesla目录，执行txt_feature_process，生成相关数据表，然后回到Juzstu/data_pre_process目录下；

   c. 运行get_num_features，生成数值特征的表；

   d. 运行get_word_features，生成文字特征的表；

   e. 运行data_merge_split，合并数值、文字以及snp数据。

2. 切换到wzm目录，依次执行generate_test_b_table、data_pre_processing1、data_pre_processing2以及generate_dataset文件；

3. 切换回Juzstu目录，进入feature_selection文件夹：

   a. 分别针对sys, dia, tl, hdl, ldl 运行snp_drop_one_hot, 得出五个对应特征的数据集，这一步骤主要是删去gbdt预训练中不重要的snp特征，然后进行one_hot编码；

   b. 分别针对sys, dia, tl, hdl, ldl 运行get_best_rounds, 得出a步骤五个数据对应的五折最优迭代次数。

4. 进入every_prediction_model文件夹，运行所有文件，得出sys，dia，tl，hdl，ldl在测试集上的预测结果；

5. 进入xgb_model_stacking文件夹：

   a. 运行add_prefix_for_xgb_model，得出带有前缀的特征数据集；

   b. 运行split_5_fold_data_xgb，分割五折训练的数据；

   c. 运行baseline_xgboost_jz，训练xgb模型；

   d. 运行calc_xgb_test_loss_and_save, 将c步骤中的五个tl的预测结果融合并取均值；

   e. 运行submit_result，提交最终结果，最终结果是sys，dia，hdl，ldl为gbdt单模型，tl为gbdt和xgb的加权融合，比例为0.7和0.35。

## 附录(包含了不同队员的思路)

### 附录一（补充第一步的txt_feature_process文件）

思路：对于文本特征的处理，依据是各项目（如 肝，胆，脾，肾）临床诊断的医学知识，分为两步：

1. 提取关键词并分类，实现对文本的处理，提取出最基本的类别特征
2. 在提取关键词的基础上，再根据双高疾病的病理特征，对关键词进行组合，得出新特征。

具体操作：

1. 根据体检项目的描述，将相同项目的文字整合到一起，统一处理，具体细节如下：
    0409 0434 为病史记录
    0102 0113 a705 肝脏检查
    0101 0102 1402 4001 心脑血管检查
    0101 0102 0912 甲状腺检查
    0102 0114 a202 胆功能检查
    0117 0118 a102 a202 肾功能检查
    0115 0102 胰腺检查
    1102 a201 a202 肺功能检查
    0509 0539 宫颈检查
    0539 0516 子宫检查
    0122 0123 0537 0541 卵巢检查
    0501 0503 0539 阴道检查
    0102 0119 膀胱检查
    0102 0119 前列腺检查
    0972 肛肠检查
    a201 0101 0911 淋巴检查
    0101 0102 0929 乳腺检查
    3601 骨量检查
    0705 0709 牙科检查
    0217 扁桃体检查
    0215 咽喉检查
    a301 脑部CT
2. 在得出上述基础特征后，进行了几项简单的特征推断，可以理解为特征组合：
    a. 根据病史中的脾、胃、肠、阑尾的情况，判断是否有消化类疾病。
    b. 根据心脑血管检查以及脂肪肝情况，判断是否存在高血脂
    c. 根据生殖科检查条目，判断性别
    d. 根据宫颈、子宫、阴道、乳腺情况，判断是否绝经
    e. 根据骨量、牙科情况，判断是否老年

### 附录二

补充：通过对数值特征的权重，范围分布，以及临床医学的相关知识，我们对脱敏特征的意义进行了推断，结果如下：

2405 BMI
2403 体重
2404 身高
2420 腰围
1850 血糖
1814 餐后两小时血糖
1815 空腹血糖
31   红细胞计数(RBC) 
312  单核细胞比值(MONO%)    
313  血红蛋白浓度(HGB)
314  红细胞分布宽度标准差(RDW-SD) 
315  平均红细胞体积(MCV)  
316  平均红细胞血红蛋白含量(MCH)  
1110 尿白细胞计数(WBC) 
1117 谷丙转氨酶(ALT)  
对这些数值型特征意义的理解，可以帮助我们进行特征组合，指导特征工程的方向。

### 附录三

数值型特征：
	1319 1320 眼压
	1321 1322 视力
	0424 0425 心率
	3301 肠道 dpm
	针对 肾、甲状腺、肝、胆 提取回声面积和结石大小，并区分单位是cm还是mm
	对前列腺数值特征进行提取
文本特征：
针对：
	0409 0434 0413 4001 a201 a301 a202 0705 0709 0985 0439
判断： 
	血压偏高 血脂偏高 血糖偏高 高血糖  是否高血糖 是否抽烟 冠心病
	肝脏情况 肾脏情况 胆结石情况 胆囊结石 胆囊息肉 肾结石 肾囊肿 肝囊 肿肝硬化 
其余文本特征：
3193 尿检
0420 0421 1001 心率情况
3399 尿液颜色
3301 Hp值
0405 肺部情况
4001 血管情况
2302 健康概况
根据性别特征关键词判断性别